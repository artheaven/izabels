# –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞: —É—Ä–æ–∫–∏ –∏–∑ –æ—à–∏–±–æ–∫

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò, –ö–û–¢–û–†–´–ï –ù–ï–õ–¨–ó–Ø –ü–û–í–¢–û–†–Ø–¢–¨

### 1. Prisma –º–∏–≥—Ä–∞—Ü–∏–∏ - –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –û—à–∏–±–∫–∞ "column recipient_phone does not exist" 
- AI —Å–æ–∑–¥–∞–ª –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é `20250113_add_recipient_phone`
- –ù–û –∫–æ–ª–æ–Ω–∫–∞ –£–ñ–ï –±—ã–ª–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ `20251129140000_make_delivery_fields_optional`
- –≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É –∏ failed –º–∏–≥—Ä–∞—Ü–∏–∏
- Failed –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ –í–°–ï –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ—à–∏–±–∫–∞ P3009)
- –ü–æ—Ç—Ä–∞—Ç–∏–ª–∏ —á–∞—Å –Ω–∞ –æ—Ç–ª–∞–¥–∫—É

**–ü–†–ê–í–ò–õ–û:**
```
–ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º –ª—é–±–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏/—Ç–∞–±–ª–∏—Ü—ã:
1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –í–°–ï —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏: grep -r "column_name" backend/prisma/migrations/
2. –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ –µ—Å—Ç—å –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ - –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é
3. –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è failed - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prisma migrate resolve --applied <migration_name>`
```

### 2. Railway: build vs runtime

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –î–æ–±–∞–≤–∏–ª `prisma migrate deploy` –≤ —Å–∫—Ä–∏–ø—Ç `build`
- –ù–∞ Railway –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï–î–û–°–¢–£–ü–ù–ê –≤–æ –≤—Ä–µ–º—è build (—Ç–æ–ª—å–∫–æ internal network –ø—Ä–∏ runtime)
- Build –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π P1001: Can't reach database server

**–ü–†–ê–í–ò–õ–û:**
```
–ù–ê Railway:
- build: —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–∏–ª—è—Ü–∏—è (tsc, next build, etc.)
- start: –∑–¥–µ—Å—å prisma migrate deploy && node server.js
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –¢–û–õ–¨–ö–û –ø—Ä–∏ runtime, –ù–ï –ø—Ä–∏ build
```

### 3. Prisma –æ—à–∏–±–∫–∞ P3009 (failed migrations)

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ú–∏–≥—Ä–∞—Ü–∏—è failed –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
- Prisma –æ—Ç–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –ø—Ä–∏–º–µ–Ω—è—Ç—å –õ–Æ–ë–´–ï –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ "fix" –º–∏–≥—Ä–∞—Ü–∏–π –Ω–µ –ø–æ–º–æ–≥–∞–ª–æ

**–ü–†–ê–í–ò–õ–û:**
```
–ü—Ä–∏ –æ—à–∏–±–∫–µ P3009 "migrate found failed migrations":
1. –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: prisma migrate resolve --applied <failed_migration_name>
3. –î–æ–±–∞–≤–∏—Ç—å –≤ start —Å–∫—Ä–∏–ø—Ç –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ production
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤

**–ü–†–ê–í–ò–õ–û:**
```
–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –õ–Æ–ë–û–ì–û –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ —É–∂–µ –ø–æ—Ö–æ–∂–µ–≥–æ —Ñ–∞–π–ª–∞
2. –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–π - grep –ø–æ –≤—Å–µ–º –º–∏–≥—Ä–∞—Ü–∏—è–º
3. –î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ - –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
```

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î PRISMA –ú–ò–ì–†–ê–¶–ò–ï–ô

- [ ] `grep -r "column_name" backend/prisma/migrations/` - –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ—Ç?
- [ ] `grep -r "table_name" backend/prisma/migrations/` - —Ç–∞–±–ª–∏—Ü—ã –Ω–µ—Ç?
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É —Å timestamp?
- [ ] –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å migrate deploy –≤ build –Ω–∞ Railway

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–ò –û–®–ò–ë–ö–ê–• –ú–ò–ì–†–ê–¶–ò–ò

- [ ] P1001 (can't reach database) ‚Üí migrate –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ start, –Ω–µ build
- [ ] P3009 (failed migrations) ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prisma migrate resolve --applied`
- [ ] P2022 (column doesn't exist) ‚Üí –°–ù–ê–ß–ê–õ–ê –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üîß –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É
grep -r "recipient_phone" backend/prisma/migrations/

# –ü–æ–º–µ—Ç–∏—Ç—å failed –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ applied
prisma migrate resolve --applied 20251129140000_make_delivery_fields_optional

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
prisma migrate status
```

## üí° –û–ë–©–ò–ï –ü–†–ò–ù–¶–ò–ü–´

1. **–°–Ω–∞—á–∞–ª–∞ –∏—Å—Å–ª–µ–¥—É–π, –ø–æ—Ç–æ–º –¥–µ–π—Å—Ç–≤—É–π** - –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
2. **–ü–æ–Ω–∏–º–∞–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—É** - Railway, Vercel –∏–º–µ—é—Ç —Å–≤–æ–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (build vs runtime)
3. **–ù–µ —Å–æ–∑–¥–∞–≤–∞–π –¥—É–±–ª–∏–∫–∞—Ç—ã** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤/–º–∏–≥—Ä–∞—Ü–∏–π/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** - –¥–ª—è failed –º–∏–≥—Ä–∞—Ü–∏–π –µ—Å—Ç—å `migrate resolve`, –Ω–µ –Ω—É–∂–Ω–æ —Ö–∞–∫–∞—Ç—å

